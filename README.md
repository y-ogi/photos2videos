# Photos2Videos

写真から4K動画を作成し、複数の動画を結合するスクリプト

## 機能

### photos2video.py
- JPG画像から4K (3840x2160) 動画を作成
- 縦長画像や横長画像に対応（ぼかし背景を自動生成）
- フォルダ構造を維持したまま出力
- H.264コーデックを使用した高品質な動画出力
- 24fpsのフレームレート

### combine_videos.py
- 個別の写真から生成した動画を結合
- フォルダごとにタイトル画面を自動生成
- フェードイン/アウトによるスムーズな遷移効果
- フォルダの処理順序をカスタマイズ可能
- 最終的に全フォルダの動画を1つの動画に結合

### davinci_resolve_generator.py
- DaVinci Resolveでランダムな動画クリップを使用してタイムラインを生成
- 指定したフォルダから動画をランダムに選択
- 各クリップの開始位置をランダムに設定
- 4Kタイムラインの自動作成
- メディアプールへのクリップの一括追加

## 必要条件

- Python 3.8以上
- FFmpeg
- DaVinci Resolve Studio（davinci_resolve_generator.pyを使用する場合）

## インストール

1. 必要なパッケージをインストール:
```bash
pip install -r requirements.txt
```

2. FFmpegがインストールされていることを確認:
```bash
ffmpeg -version
```

3. DaVinci Resolve Python APIの設定（davinci_resolve_generator.pyを使用する場合）:
```bash
source setup_resolve_env.sh
```

## 使用方法

### 写真から動画を作成

```bash
python photos2video.py 入力フォルダ 出力フォルダ [--duration 秒数]
```

#### 引数
- `入力フォルダ`: JPG画像が含まれているフォルダのパス
- `出力フォルダ`: 動画を出力するフォルダのパス
- `--duration`: 動画の長さ（秒）。デフォルトは5秒

### 動画の結合

```bash
python combine_videos.py 入力フォルダ 出力フォルダ [--photo-duration 秒数] [--folder-order フォルダ名1 フォルダ名2 ...]
```

#### 引数
- `入力フォルダ`: 写真が含まれているフォルダのパス
- `出力フォルダ`: 結合した動画を出力するフォルダのパス
- `--photo-duration`: 各写真の動画の長さ（秒）。デフォルトは5秒
- `--folder-order`: フォルダの処理順序を指定（オプション）。指定しない場合はファイル名順

### DaVinci Resolveでタイムラインを生成

```bash
source setup_resolve_env.sh
python davinci_resolve_generator.py 入力フォルダ [--clip-duration 秒数] [--total-duration 秒数]
```

#### 引数
- `入力フォルダ`: MP4動画が含まれているフォルダのパス
- `--clip-duration`: 各クリップの長さ（秒）。デフォルトは5秒
- `--total-duration`: 完成動画の目標長さ（秒）。デフォルトは60秒

#### 使用手順
1. DaVinci Resolveを起動し、プロジェクトを開く
2. スクリプトを実行してタイムラインを生成
3. 生成されたタイムラインにトランジションを手動で追加
   - クリップ間の境界をダブルクリック
   - 「クロスディゾルブ」などの任意のトランジションを選択
   - 必要に応じてトランジションの長さを調整

## DaVinci Resolve APIの制限事項

現在のDaVinci Resolve APIには以下の制限があります：

1. トランジションの自動追加
   - APIを通じたトランジションの追加が正常に機能しない
   - トランジションは手動で追加する必要がある
   - スクリプトはタイムラインをコピーし、トランジションを追加すべき位置に再生ヘッドを配置する

2. Fusionエフェクト
   - スクリプトからのFusionエフェクトの完全な制御が困難
   - 複雑なエフェクトは手動で追加することを推奨

3. プロジェクト設定
   - 一部のプロジェクト設定がAPIを通じて変更できない
   - 重要な設定は事前にGUIで設定することを推奨

## トランジションの追加方法

スクリプトを実行すると、以下の2つのタイムラインが作成されます：

1. `Random Timeline YYYYMMDD_HHMMSS`
   - 選択されたクリップが配置された基本的なタイムライン
   - トランジションなし

2. `Random Timeline with Transitions YYYYMMDD_HHMMSS`
   - 上記タイムラインのコピー
   - トランジションを追加するための準備済み

トランジションを追加するには：
1. DaVinci Resolveで `Random Timeline with Transitions` タイムラインを開く
2. タイムライン上でクリップの境界をダブルクリック
3. 「クロスディゾルブ」などのトランジションを選択
4. 必要に応じてトランジションの長さを調整

## 出力仕様

### 個別の動画
- 解像度: 3840x2160 (4K)
- コーデック: H.264
- フレームレート: 24fps
- ビットレート: 20Mbps
- 出力形式: MP4

### 結合後の動画
- フォルダごとのタイトル画面付き
- フェードイン/アウトによる遷移効果
- 個別の動画と同じ品質仕様
- 最終的に1つの動画ファイルとして出力

### DaVinci Resolveタイムライン
- 解像度: 3840x2160 (4K)
- フレームレート: 24fps
- ランダムに選択されたクリップで構成
- トランジションは手動で追加が必要

## 新機能: トランジション

DaVinci Resolve 19でクリップ間にトランジションを追加する機能が追加されました。ただし、DaVinci Resolve APIの制限により、トランジションの自動追加は現在完全には機能しません。

### 使用方法

トランジションを追加するには、以下のコマンドラインオプションを使用します：

```bash
python davinci_resolve_generator.py 入力フォルダ --add-transitions --transition-duration 24
```

- `--add-transitions`: クリップ間にトランジションを追加するための準備を行います
- `--transition-duration`: トランジションの長さをフレーム数で指定します（デフォルト: 24フレーム）

### 制限事項

- **APIの制限**: 現在のDaVinci Resolve APIでは、スクリプトからトランジションを完全に自動で追加することができません
- **手動追加が必要**: トランジションは手動でDaVinci Resolveのインターフェースから追加する必要があります
- **解決策**: スクリプトは元のタイムラインをコピーし、トランジションを追加すべき位置に再生ヘッドを配置します

### 手動でトランジションを追加する手順

スクリプトを実行すると、以下の2つのタイムラインが作成されます：

1. `Random Timeline YYYYMMDD_HHMMSS`
   - 選択されたクリップが配置された基本的なタイムライン
   - トランジションなし

2. `Random Timeline with Transitions YYYYMMDD_HHMMSS`
   - 上記タイムラインのコピー
   - トランジションを追加するための準備済み

トランジションを追加するには：
1. DaVinci Resolveで `Random Timeline with Transitions` タイムラインを開く
2. タイムライン上でクリップの境界をダブルクリック
3. 「クロスディゾルブ」などのトランジションを選択
4. 必要に応じてトランジションの長さを調整

### 将来の改善

将来のDaVinci Resolve APIのバージョンでは、トランジションの自動追加機能が改善される可能性があります。その場合、スクリプトを更新して完全に自動化されたトランジション追加をサポートする予定です。

## 新機能: テキストオーバーレイ

DaVinci Resolveのタイムラインに自動的にテキストオーバーレイを追加する機能が追加されました。この機能を使用すると、クリップごとに撮影日時や場所などのメタデータを表示できます。

### 使用方法

テキストオーバーレイを追加するには、以下のコマンドラインオプションを使用します：

```bash
python davinci_resolve_generator.py 入力フォルダ --add-text-overlay --text-template "{filename_date} {filename_time}" --text-position bottom --text-style default
```

- `--add-text-overlay`: クリップにテキストオーバーレイを追加します
- `--text-template`: テキストのテンプレートを指定します（デフォルト: "{filename_date} {filename_time}"）
- `--text-position`: テキストの位置を指定します（デフォルト: "bottom"）
  - 選択肢: "top", "bottom", "center", "top_left", "top_right", "bottom_left", "bottom_right"
- `--text-style`: テキストのスタイルを指定します（デフォルト: "default"）
  - 選択肢: "default", "subtitle", "title", "watermark"

### テンプレートで使用可能なメタデータ

テキストテンプレートでは、以下のようなメタデータプレースホルダーを使用できます：

- `{filename_date}`: ファイル名から抽出した日付（例: 2025年02月05日）
- `{filename_time}`: ファイル名から抽出した時刻（例: 13:26:08）
- `{formatted_date}`: ファイルのメタデータから抽出した日付
- `{formatted_time}`: ファイルのメタデータから抽出した時刻
- `{mtime_date}`: ファイルの最終更新日
- `{mtime_time}`: ファイルの最終更新時刻

その他、ファイルのメタデータに含まれる情報も使用できます（カメラの機種名、GPSデータなど）。

### 制限事項

- **APIの制限**: 現在のDaVinci Resolve APIでは、テキストの詳細な設定（フォント、サイズ、色など）を完全に制御することができません
- **手動調整が必要**: テキストの詳細な外観は、DaVinci Resolveのインターフェースから手動で調整する必要があります
- **解決策**: スクリプトはタイトルを追加し、ユーザーが後で調整できるようにします

### テキストオーバーレイの調整手順

1. DaVinci Resolveでタイムラインを開く
2. タイトルトラックに追加されたテキストを選択
   - タイムラインの上部にある「Text+」または「Text Plus」というクリップを選択
3. インスペクタパネルでテキスト内容を設定
   - 右側のインスペクタパネルを開く（右上の「インスペクタ」アイコンをクリック）
   - 「テキスト」セクションを展開
   - 「テキスト」フィールドに、スクリプトが出力した「設定すべきテキスト」の内容を入力
4. テキストの位置を調整
   - 「レイアウト」セクションを展開
   - 「位置」の値を調整（例: bottomの場合は、Y値を大きくして画面下部に配置）
   - 位置の目安:
     - top: Y = 0.1（画面上部）
     - bottom: Y = 0.9（画面下部）
     - center: X = 0.5, Y = 0.5（画面中央）
     - top_left: X = 0.1, Y = 0.1（左上）
     - top_right: X = 0.9, Y = 0.1（右上）
     - bottom_left: X = 0.1, Y = 0.9（左下）
     - bottom_right: X = 0.9, Y = 0.9（右下）
5. テキストのスタイルを調整
   - 「フォント」セクションを展開
   - フォント、サイズ、色、太さなどを調整
   - スタイルの目安:
     - default: サイズ = 50, 色 = 白
     - subtitle: サイズ = 40, 色 = 白, 背景色 = 半透明黒
     - title: サイズ = 70, 太字, 色 = 白
     - watermark: サイズ = 30, 透明度 = 50%
6. 必要に応じてアニメーションやエフェクトを追加
   - 「エフェクト」セクションを展開
   - フェードイン/アウトなどのエフェクトを追加

### テキストが表示されない場合の対処法

テキストが表示されない場合は、以下の手順を試してください：

1. タイムラインの表示設定を確認
   - タイムライン上部の「表示オプション」（目のアイコン）をクリック
   - 「ビデオ」→「タイトル」が有効になっていることを確認
2. 新しいテキストを手動で追加
   - タイムラインを右クリック→「タイトルを追加」→「テキスト」を選択
   - 追加されたテキストを編集して、必要な内容を設定
3. テキストの位置とサイズを調整
   - テキストが画面外や非常に小さいサイズになっている可能性があります
   - インスペクタで位置とサイズを調整してください

### 将来の改善

将来のDaVinci Resolve APIのバージョンでは、テキストオーバーレイの詳細な設定が可能になる可能性があります。その場合、スクリプトを更新してより高度なテキスト制御をサポートする予定です。